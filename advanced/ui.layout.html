<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Declarative layouts - Avendish documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../foreword.html"><strong aria-hidden="true">1.</strong> Foreword</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting started</li><li class="chapter-item expanded "><a href="../getting_started/hello_world.html"><strong aria-hidden="true">2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../getting_started/compiling.html"><strong aria-hidden="true">3.</strong> Compiling</a></li><li class="chapter-item expanded "><a href="../getting_started/running.html"><strong aria-hidden="true">4.</strong> Running</a></li><li class="chapter-item expanded affix "><li class="part-title">Writing CPU processors</li><li class="chapter-item expanded "><a href="../writing_processors/ports.html"><strong aria-hidden="true">5.</strong> Adding ports</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing_processors/ports.refactoring.html"><strong aria-hidden="true">5.1.</strong> Simplifying ports</a></li><li class="chapter-item expanded "><a href="../writing_processors/ports.helpers.html"><strong aria-hidden="true">5.2.</strong> Helpers for ports</a></li><li class="chapter-item expanded "><a href="../writing_processors/ports.metadatas.html"><strong aria-hidden="true">5.3.</strong> Port metadatas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing_processors/ports.metadatas.range.html"><strong aria-hidden="true">5.3.1.</strong> Range</a></li><li class="chapter-item expanded "><a href="../writing_processors/ports.metadatas.widget.html"><strong aria-hidden="true">5.3.2.</strong> Widget</a></li><li class="chapter-item expanded "><a href="../writing_processors/ports.metadatas.mapping.html"><strong aria-hidden="true">5.3.3.</strong> Mapping</a></li><li class="chapter-item expanded "><a href="../writing_processors/ports.metadatas.helpers.html"><strong aria-hidden="true">5.3.4.</strong> Helpers</a></li></ol></li><li class="chapter-item expanded "><a href="../writing_processors/ports.update.html"><strong aria-hidden="true">5.4.</strong> Update callback</a></li></ol></li><li class="chapter-item expanded "><a href="../writing_processors/audio.html"><strong aria-hidden="true">6.</strong> Audio</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing_processors/audio.polyphonic.html"><strong aria-hidden="true">6.1.</strong> Monophonic processors</a></li><li class="chapter-item expanded "><a href="../writing_processors/audio.setup.html"><strong aria-hidden="true">6.2.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../writing_processors/audio.arguments.html"><strong aria-hidden="true">6.3.</strong> Playback state</a></li><li class="chapter-item expanded "><a href="../writing_processors/audio.fft.html"><strong aria-hidden="true">6.4.</strong> FFT</a></li></ol></li><li class="chapter-item expanded "><a href="../writing_processors/messages.html"><strong aria-hidden="true">7.</strong> Messages</a></li><li class="chapter-item expanded "><a href="../writing_processors/callbacks.html"><strong aria-hidden="true">8.</strong> Callbacks</a></li><li class="chapter-item expanded "><a href="../writing_processors/init.html"><strong aria-hidden="true">9.</strong> Initialization</a></li><li class="chapter-item expanded "><a href="../writing_processors/midi.html"><strong aria-hidden="true">10.</strong> MIDI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing_processors/midi.example.html"><strong aria-hidden="true">10.1.</strong> Example</a></li></ol></li><li class="chapter-item expanded "><a href="../writing_processors/images.html"><strong aria-hidden="true">11.</strong> Image</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing_processors/images.example.html"><strong aria-hidden="true">11.1.</strong> Example</a></li></ol></li><li class="chapter-item expanded "><a href="../writing_processors/metadatas.html"><strong aria-hidden="true">12.</strong> Metadatas</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced features</li><li class="chapter-item expanded "><a href="../advanced/port_types.html"><strong aria-hidden="true">13.</strong> Port data types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/port_types.example.html"><strong aria-hidden="true">13.1.</strong> Example</a></li><li class="chapter-item expanded "><a href="../advanced/port_types.file.html"><strong aria-hidden="true">13.2.</strong> Files</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/port_types.file.sound.html"><strong aria-hidden="true">13.2.1.</strong> Sound files</a></li><li class="chapter-item expanded "><a href="../advanced/port_types.file.midi.html"><strong aria-hidden="true">13.2.2.</strong> MIDI files</a></li><li class="chapter-item expanded "><a href="../advanced/port_types.file.raw.html"><strong aria-hidden="true">13.2.3.</strong> Raw files</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../advanced/ui.html"><strong aria-hidden="true">14.</strong> Custom UI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/ui.layout.html" class="active"><strong aria-hidden="true">14.1.</strong> Declarative layouts</a></li><li class="chapter-item expanded "><a href="../advanced/ui.painting.html"><strong aria-hidden="true">14.2.</strong> Custom items</a></li><li class="chapter-item expanded "><a href="../advanced/ui.messages.html"><strong aria-hidden="true">14.3.</strong> Message bus</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/ui.messages.example.html"><strong aria-hidden="true">14.3.1.</strong> Example</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../advanced/injection.html"><strong aria-hidden="true">15.</strong> Feature injection</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/logging.html"><strong aria-hidden="true">15.1.</strong> Logging</a></li><li class="chapter-item expanded "><a href="../advanced/fft.html"><strong aria-hidden="true">15.2.</strong> FFT</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced/presets.html"><strong aria-hidden="true">16.</strong> Presets</a></li><li class="chapter-item expanded "><a href="../advanced/sample_accurate.html"><strong aria-hidden="true">17.</strong> Sample-accurate processing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/sample_accurate.example.html"><strong aria-hidden="true">17.1.</strong> Example</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced/channel_mimicking.html"><strong aria-hidden="true">18.</strong> Channel mimicking</a></li><li class="chapter-item expanded "><a href="../advanced/workers.html"><strong aria-hidden="true">19.</strong> Threaded workers</a></li><li class="chapter-item expanded "><a href="../advanced/cmake.html"><strong aria-hidden="true">20.</strong> CMake configuration</a></li><li class="chapter-item expanded affix "><li class="part-title">Writing GPU processors</li><li class="chapter-item expanded "><a href="../gpu/draw.html"><strong aria-hidden="true">21.</strong> Draw nodes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../gpu/draw.layout.html"><strong aria-hidden="true">21.1.</strong> Defining a layout</a></li><li class="chapter-item expanded "><a href="../gpu/draw.calls.html"><strong aria-hidden="true">21.2.</strong> API calls</a></li><li class="chapter-item expanded "><a href="../gpu/draw.minimal.html"><strong aria-hidden="true">21.3.</strong> Minimal pipeline</a></li><li class="chapter-item expanded "><a href="../gpu/draw.example.html"><strong aria-hidden="true">21.4.</strong> Complete example</a></li></ol></li><li class="chapter-item expanded "><a href="../gpu/compute.html"><strong aria-hidden="true">22.</strong> Compute nodes</a></li><li class="chapter-item expanded affix "><li class="part-title">Development</li><li class="chapter-item expanded "><a href="../development/predicates.html"><strong aria-hidden="true">23.</strong> Type predicates</a></li><li class="chapter-item expanded "><a href="../development/flags.html"><strong aria-hidden="true">24.</strong> Flags</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Avendish documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="layout-based-uis"><a class="header" href="#layout-based-uis">Layout-based UIs</a></h1>
<blockquote>
<p>Supported bindings: ossia, others are work-in-progress</p>
</blockquote>
<p>To define a custom UI, one has to add a <code>struct ui</code> in the processor definition.</p>
<pre><code class="language-cpp">struct MyProcessor {
  struct ui {
   
  };
};
</code></pre>
<p>By default, this will do nothing: we have to fill it. <code>ui</code> will be the top-level widget.
Child widgets can be added simply by defining struct members.
Containers are defined by adding a <code>layout()</code> function which returns an enum value, which may 
currently be any of the following names:</p>
<pre><code>hbox,
vbox,
container,
group,
split,
tabs,
grid,
spacing,
control,
custom
</code></pre>
<p>For instance:</p>
<pre><code class="language-cpp">struct ui
{
  static constexpr auto layout() { enum { hbox } d{}; return d; }
  struct {
    static constexpr auto layout() { enum { vbox } d{}; return d; }
    const char* text = &quot;text&quot;;
    decltype(&amp;ins::int_ctl) int_widget = &amp;ins::int_ctl;
  } widgets;

  struct {
    static constexpr auto layout() { enum { spacing } d{}; return d; }
    static constexpr auto width() { return 20; }
    static constexpr auto height() { return 20; }
  } a_spacing;

  const char* text = &quot;text2&quot;;
};
</code></pre>
<p>This defines, conceptually, the following layout:</p>
<pre><code class="language-ascii">|-----------------------------|
|  |  text  |                 |
|  |        |                 |
|  | =widg= |  &lt;20px&gt;  text2  |
|  |        |                 |
|  |        |                 |
|-----------------------------|
</code></pre>
<h2 id="layouts"><a class="header" href="#layouts">Layouts</a></h2>
<h3 id="hbox-vbox"><a class="header" href="#hbox-vbox">HBox, VBox</a></h3>
<p>These will layout things either horizontally or vertically.</p>
<h3 id="split"><a class="header" href="#split">Split</a></h3>
<p>Each children will be separated by a split line (thus generally one would use it to separate layouts).</p>
<h3 id="grid"><a class="header" href="#grid">Grid</a></h3>
<p>This will layout children items in a grid.</p>
<p>Either of <code>rows()</code> and <code>columns()</code> properties can be defined, but not both:</p>
<pre><code>static constexpr auto rows() { return 3; }
static constexpr auto columns() { return 3; }
</code></pre>
<p>If <code>columns()</code> is defined, children widget will be laid out in the first row until the column count is reached, then in the second row, etc. until there are no more children items, and conversely if <code>rows()</code> is defined.</p>
<p>That is, given: </p>
<pre><code class="language-cpp">struct {
  static constexpr auto layout() { enum { grid } d{}; return d; }
  static constexpr auto columns() { return 3; }
  const char* text1 = &quot;A&quot;;
  const char* text2 = &quot;B&quot;;
  const char* text3 = &quot;C&quot;;
  const char* text4 = &quot;D&quot;;
  const char* text5 = &quot;E&quot;;
} a_grid;
</code></pre>
<p>The layout will be:</p>
<pre><code class="language-ascii">|---------|
| A  B  C | 
| D  E    |
|---------|
</code></pre>
<p>Instead, if <code>rows()</code> is defined to 3:</p>
<pre><code class="language-ascii">|------|
| A  D | 
| B  E | 
| C    |
|------|
</code></pre>
<h3 id="tabs"><a class="header" href="#tabs">Tabs</a></h3>
<p>Tabs will display children items in tabs.
Each children item should have a <code>name()</code> property which will be shown in the tab bar.</p>
<pre><code class="language-cpp">struct {
  static constexpr auto layout() { enum { tabs } d{}; return d; }
  struct {
    static constexpr auto layout() { enum { hbox } d{}; return d; }
    static constexpr auto name() { return &quot;First tab&quot;; }
    const char* text1 = &quot;A&quot;;
    const char* text2 = &quot;B&quot;;
  } a_hbox;
  struct {
    static constexpr auto layout() { enum { hbox } d{}; return d; }
    static constexpr auto name() { return &quot;Second tab&quot;; }
    const char* text3 = &quot;C&quot;;
    const char* text4 = &quot;D&quot;;
  } a_vbox;
} a_tabs;
</code></pre>
<h2 id="properties"><a class="header" href="#properties">Properties</a></h2>
<h3 id="background-color"><a class="header" href="#background-color">Background color</a></h3>
<p>Background colors can be chosen from a standardized set: for now, those are fairly abstract to allow things to work in a variety of environments.</p>
<pre><code>darker,
dark,
mid,
light,
lighter
</code></pre>
<p>Setting the color is done by adding this to a layout:</p>
<pre><code class="language-cpp">static constexpr auto background() { enum { dark } d{}; return d; }
</code></pre>
<h3 id="explicit-positioning"><a class="header" href="#explicit-positioning">Explicit positioning</a></h3>
<p>In &quot;group&quot; or &quot;container&quot; layouts, widgets will not be positioned automatically. <code>x</code> and <code>y</code> methods can be used for that.</p>
<pre><code class="language-cpp">static constexpr auto x() { return 20; }
static constexpr auto y() { return 20; }
</code></pre>
<h3 id="explicit-sizing"><a class="header" href="#explicit-sizing">Explicit sizing</a></h3>
<p>Containers can be given an explicit (device independent) pixel size with </p>
<pre><code class="language-cpp">static constexpr auto width() { return 100; }
static constexpr auto height() { return 50; }
</code></pre>
<p>Otherwise, things will be made to fit in a best-effort way.</p>
<h2 id="items"><a class="header" href="#items">Items</a></h2>
<h2 id="text-labels"><a class="header" href="#text-labels">Text labels</a></h2>
<p>The simplest item is the text label: simply adding a <code>const char*</code> member is sufficient. </p>
<h2 id="controls"><a class="header" href="#controls">Controls</a></h2>
<p>One can add a control (either input or output) simply by adding a member pointer to it: </p>
<pre><code class="language-cpp">struct MyProcessor {
  struct ins {
    halp::hslider_f32&lt;&quot;Foo&quot;&gt; foo;
  } inputs;

  struct ui
  {
    static constexpr auto layout() { enum { hbox } d{}; return d; }
    const char* text = &quot;text&quot;;
    decltype(&amp;ins::foo) int_widget = &amp;ins::foo;
  };
};
</code></pre>
<p>The syntax without helpers currently needs some repeating as C++ does not yet allow <code>auto</code> as member fields, otherwise it'd just be:</p>
<pre><code class="language-cpp">auto int_widget = &amp;ins::foo;
</code></pre>
<h1 id="helpers"><a class="header" href="#helpers">Helpers</a></h1>
<p>Helpers simplify common tasks ; here, C++20 designated-initializers allow us to have a very pretty API and reduce repetitions:</p>
<h2 id="widget-helpers"><a class="header" href="#widget-helpers">Widget helpers</a></h2>
<pre><code class="language-cpp">halp::label l1{
    .text = &quot;some long foo&quot;
  , .x = 100
  , .y = 25
};

halp::item&lt;&amp;ins::foo&gt; widget{
    .x = 75
  , .y = 50
};
</code></pre>
<h2 id="properties-helpers"><a class="header" href="#properties-helpers">Properties helpers</a></h2>
<pre><code class="language-cpp">struct ui {
 // If your compiler is recent enough you can do this, 
 // otherwise layout and background enums have to be qualified:
 using enum halp::colors;
 using enum halp::layouts;
 
 halp_meta(name, &quot;Main&quot;)
 halp_meta(layout, hbox)
 halp_meta(background, mid)

 struct {
   halp_meta(name, &quot;Widget&quot;)
   halp_meta(layout, vbox)
   halp_meta(background, dark)
   halp::item&lt;&amp;ins::int_ctl&gt; widget;
   halp::item&lt;&amp;outs::measure&gt; widget2;
 } widgets;
};
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../advanced/ui.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../advanced/ui.painting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../advanced/ui.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../advanced/ui.painting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
