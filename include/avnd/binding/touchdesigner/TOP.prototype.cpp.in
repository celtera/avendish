/* SPDX-License-Identifier: GPL-3.0-or-later */

/**
 * TouchDesigner TOP plugin entry point template
 * This file is processed by CMake to instantiate the binding for a specific processor
 */

// clang-format off
#include <@AVND_MAIN_FILE@>
#include <avnd/binding/touchdesigner/configure.hpp>
#include <avnd/binding/touchdesigner/top/texture_processor.hpp>

// Include TouchDesigner headers
#include "TOP_CPlusPlusBase.h"

using type = decltype(avnd::configure<touchdesigner::config, @AVND_MAIN_CLASS@>())::type;
// clang-format on

namespace td = touchdesigner::TOP;

// Plugin export functions required by TouchDesigner
extern "C"
{

DLLEXPORT
void FillTOPPluginInfo(TD::TOP_PluginInfo* info)
{
  info->apiVersion = TD::TOPCPlusPlusAPIVersion;
  touchdesigner::configure_opInfo<type>(info->customOPInfo, "@AVND_C_NAME@", "@AVND_OPTYPE@");
}

DLLEXPORT
TD::TOP_CPlusPlusBase* CreateTOPInstance(const TD::OP_NodeInfo* info)
{
  return new td::texture_processor<type>(info, static_cast<TD::TOP_Context*>(info->context));
}

DLLEXPORT
void DestroyTOPInstance(TD::TOP_CPlusPlusBase* instance)
{
  delete static_cast<td::texture_processor<type>*>(instance);
}

}
