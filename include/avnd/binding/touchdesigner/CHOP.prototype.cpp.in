/* SPDX-License-Identifier: GPL-3.0-or-later */

/**
 * TouchDesigner CHOP plugin entry point template
 * This file is processed by CMake to instantiate the binding for a specific processor
 */

// clang-format off
#include <@AVND_MAIN_FILE@>
#include <avnd/binding/touchdesigner/configure.hpp>
#include <avnd/binding/touchdesigner/chop/audio_processor.hpp>
#include <avnd/binding/touchdesigner/chop/audio_processor.impl.hpp>

// Include TouchDesigner headers
#include "CHOP_CPlusPlusBase.h"

using type = decltype(avnd::configure<touchdesigner::config, @AVND_MAIN_CLASS@>())::type;
// clang-format on

namespace td = touchdesigner::chop;

// Plugin export functions required by TouchDesigner
extern "C"
{

DLLEXPORT
void FillCHOPPluginInfo(TD::CHOP_PluginInfo* info)
{
  info->apiVersion = TD::CHOPCPlusPlusAPIVersion;
  touchdesigner::configure_opInfo<type>(info->customOPInfo, "@AVND_C_NAME@", "@AVND_OPTYPE@");
}

DLLEXPORT
TD::CHOP_CPlusPlusBase* CreateCHOPInstance(const TD::OP_NodeInfo* info)
{
  return new td::audio_processor<type>(info);
}

DLLEXPORT
void DestroyCHOPInstance(TD::CHOP_CPlusPlusBase* instance)
{
  delete static_cast<td::audio_processor<type>*>(instance);
}

}
